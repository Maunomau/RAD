<!DOCTYPE html>
<title>RADiaNTFoRM</title>


<style>
    canvas{
        outline: 1px solid white;
    }

    body{
        background-color: indigo;
        text-align: center;
        margin-top: 50px;
    }
</style>


text
<br>
<canvas></canvas>
<script src="https://cdn.jsdelivr.net/npm/rot-js@2/dist/rot.js"></script>
<script src="rotjs/rot.js"></script>
<script src="js/game.js"></script>
<script src="js/map.js"></script>
<script src="js/tile.js"></script>
<script src="js/monster.js"></script>
<script src="js/util.js"></script>
<script src="js/spell.js"></script>
<script>


  monstersheet = new Image();
  monstersheet.src = 'monsters.png';

  playersheet = new Image();
  playersheet.src = 'art/player16x16belt-runed4.png';
  playersheet.src = 'art/player16x16belt-runed3.png';
  playersheet.src = 'art/player16x16belt-runed2.png';
  playersheet.src = 'art/player16x16belt-runed1.png';
  playersheet.src = 'art/player16x16belt.png';
  playersheet.src = 'art/player16x16-runed4.png';
  playersheet.src = 'art/player16x16-runed3.png';
  playersheet.src = 'art/player16x16-runed2.png';
  playersheet.src = 'art/player16x16-runed1.png';
  playersheet.src = 'art/player16x16.png';
  playersheet.src = 'art/pol-.png';

  beltsheet = new Image();
  beltsheet.src = 'art/pol-belt.png';
  belt2sheet = new Image();
  belt2sheet.src = 'art/pol-belt2.png';

  runes0sheet = new Image();
  runes0sheet.src = 'art/pol-runes0-belly.png';
  runes1sheet = new Image();
  runes1sheet.src = 'art/pol-runes1-waist-chest.png';
  runes2sheet = new Image();
  runes2sheet.src = 'art/pol-runes2-arms.png';
  runes3sheet = new Image();
  runes3sheet.src = 'art/pol-runes3-legs.png';
  runes4sheet = new Image();
  runes4sheet.src = 'art/pol-runes4-top.png';
  //let runeSpriteOptions = [runes0sheet,runes1sheet,runes2sheet,runes3sheet,runes4sheet];
  runesprites = [] //used to combine random runesheets

  effectsheet = new Image();
  effectsheet.src = 'effects.png';

  tileset = new Image();
  tileset.src = 'tiles.png';

  maincircle = new Image();
  maincircle.src = 'art/maincircle2c.png';
  maincircle.src = 'art/maincircle2b.png';
  maincircle.src = 'art/maincircle2.png';
  maincircle.src = 'art/maincircle1.png';

  circles = new Image();
  circles.src = 'art/circles.png';

  //There's a better way to do this I assume.
  pipred = new Image();
  pipred.src = 'pipred.png';

  pipredshield = new Image();
  pipredshield.src = 'pipredwhite.png';

  pipblue = new Image();
  pipblue.src = 'pipblue.png';

  pipblueshield = new Image();
  pipblueshield.src = 'pipbluewhite.png';

  pipyellow = new Image();
  pipyellow.src = 'pipyellow.png';

  pipyellowshield = new Image();
  pipyellowshield.src = 'pipyellowwhite.png';

  pipshield = new Image();
  pipshield.src = 'pipwhite.png';

  pipgray = new Image();
  pipgray.src = 'pipgray.png';

  pipgrayshield = new Image();
  pipgrayshield.src = 'pipgraywhite.png';

  pipz0 = new Image();
  pipz0.src = 'pipZ0.png';

  pipz1 = new Image();
  pipz1.src = 'pipZ1.png';

  pipz2 = new Image();
  pipz2.src = 'pipZ2.png';

  tileset.onload = showTitle;

  //tileSize = 64;
  tileSize = 32;
  numTiles = 16;
  uiWidth = 5;
  level = 1;
  day = 1;
  time = 0;
  darkness = 0;
  timeInDay = 500;
  roomCount = 0;
  roomMax = 24;
  maxHp = 10; 
  seenMons = new Set();
  
  gameState = "loading";

  startingHp = 3;
  numLevels = 8;
  
  shakeAmount = 0;
  shakeX = 0;
  shakeY = 0;
  
  soundsplayed = {}
  
  //I feel like there's a better way to achieve this but this works.
  //dirmap = [{x:0,y:1}, {x:-1,y:0}, {x:0,y:-1}, {x:1,y:0}]
  dirmap = [
    [0,1],
    [-1,0],
    [0,-1],
    [1,0]
  ]
  wdirmap = [
    [0,1,0,0],
    [-1,0,0,0],
    [0,-1,0,0],
    [1,0,0,0],
    [0,0,-1,0],
    [0,0,1,0],
    [0,0,0,-1],
    [0,0,0,1],
  ]//4 down, 5 up, 6 lower, 7 higher
  
  RWord = ROT.RNG.getItem(["Raging", "Rampant", "Ravenous", "Restless", "Ridiculous", "Rough", "Rowdy", "Rugged", "Ruthless"]);
  
  mapRNG = ROT.RNG.clone();
  gRNG = ROT.RNG.clone();
  worldRNG = ROT.RNG.clone();
  savedMaps = {};
  //savedMaps = [];
  clonedMaps = [];
  
  logUncollapseMode = "mapgen";
  logUncollapseMode = "turns";
  
  document.querySelector("html").onkeypress = function(e){
    //console.log("Pressed "+e.key+".");

    if(gameState == "title"){
      startGame();
    }else if(gameState == "dead"){
      showTitle();
    }else if(gameState == "running"){
      //turn ending keys... not sure how I feel about doing this.
      if(e.key=="w"||e.key=="a"||e.key=="s"||e.key=="d"||e.key=="z"||(e.key=="c"&&player.small||e.key>=1 && e.key<=9)){
        if (logUncollapseMode == "turns")console.group("Turn:"+turn+"("+levelturn+")");
        else console.groupCollapsed("Turn:"+turn+"("+levelturn+")");
      }
      if(e.key=="w") {
        player.tryMove(0, -1);
        player.dir = 2;
      }
      if(e.key=="s") {
        player.tryMove(0, 1);
        player.dir = 0;
      }
      if(e.key=="a") {
        player.tryMove(-1, 0);
        player.dir = 1;
      }
      if(e.key=="d") {
        player.tryMove(1, 0);
        player.dir = 3;
      }
      if(e.key=="q") {
        if (player.dir > 0) player.dir = player.dir-1;
        else player.dir = 3;//Type coercion is neat
        player.lastMove = dirmap[player.dir];
        player.TUs++
        console.log("turning left. Set last move to"+JSON.stringify(dirmap[player.dir])+" and dir to "+player.dir+".");
      }
      if(e.key=="e") {
        if (player.dir < 3) player.dir = player.dir+1;
        else player.dir = 0;
        player.lastMove = dirmap[player.dir];
        player.TUs++
        console.log("turning right. Set last move to"+JSON.stringify(dirmap[player.dir])+" and dir to "+player.dir+".");
      }
      if(e.key=="x") {
        player.tile.interactWith(player);
      }
      if(e.key=="z") {//x and c are kind of close and it's easy to press wrong one.
        player.rest();
      }
      if(e.key=="c") {
        player.crouch();
      }
      
      //Not how I'd like to do this but will do for now.
      if(e.key>=1 && e.key<=9) player.castSpell(e.key-1);
      if(e.key=="0") player.castSpell(9);
      
      //Debug keys
      if(e.key=="r") {
        //startLevel(0, 0, 0, 0, day);
        //startLevel(worldPos[0], worldPos[1], worldPos[2], worldPos[3], day);
        //startLevel(wpos.join(''));
        startLevel(0);
      }
      if(e.key=="t") {
        generateTiles();
      }
      if(e.key=="g") {
        usedCharges.push([0, 1, player.tile, 1]);
      }
      if(e.key=="l") {
        tiles[player.tile.x][player.tile.y].monster = undefined;
        player = undefined;
        tiles = savedMaps[level-1].map ;//If I don't clone the map before saving this loads the map from when I left that particular level, that's potentially nice.
        player = new Player(randomPassableTile("gem", gRNG));
        //getMonsters();
        monsters = savedMaps[level-1].mons ;
        console.log("Loading saved map "+ level-1 +".");
        //startLevel2(0)
      }
      
      console.groupEnd()
    }
  };
  
  document.querySelector("html").onkeydown = function(e){
    //console.log("Key down "+e.key+".");
  }
  
  document.querySelector("html").onkeyup = function(e){
    //console.log("Key up "+e.key+".");
  }


  setInterval(draw, 15);

  setupCanvas();
  initSounds();

</script>
<br>
text2 <script>//gameState</script>